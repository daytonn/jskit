var JSkit=function(){if(!_)throw new Error("JSkit: lodash or underscore is required");return{createApplication:function(){return JSkit.Application.create()}}}();JSkit.Dispatcher=function(){function n(n,t){return n.__events__[t]=n.__events__[t]||[],n.__events__[t]}function t(n,t){return n=n||null,{context:n,handler:t}}function e(n,t,e){e=e||"push",r(n,t)||n[e](t)}var r=_.any,i=_.each;return{create:function(){return{__events__:{},on:function(r,i,o){var c=t(o,i),a=n(this,r);e(a,c)},before:function(r,i,o){var c=t(o,i),a=n(this,r);e(a,c,"unshift")},off:function(n,t){var e=this.__events__[n];t?this.__events__[n]=_.reject(e,function(n){return n.handler!==t}):this.__events__[n]=[]},trigger:function(n){var t=this.__events__[n]||[],e=_.rest(arguments);i(t,function(n){var t=n.handler,r=n.context;t.apply(r,e)})}}}}}(),JSkit.Controller=function(){function n(n,t){return J([n.namespace,n.channel,n.controllerEventName,t]).join(n.eventSeparator)}function t(n){n.__actions__=b(F(n.actions,function(n){return e(n)}))}function e(n){return N(n)?F(n,r):[r(n,n)]}function r(n,t){return{name:t,method:n}}function i(n,t){if(!x(n[t.method]))throw new Error(n.name+' action "'+t.name+":"+t.method+'" method is undefined')}function o(t){g(t.__actions__,function(e){i(t,e),t.dispatcher.on(n(t,e.name),t[e.method],t)})}function c(n){n.__elements__=O(n.elements,function(n,t,e){return n[e]=a(t),n},{})}function a(n){return O(n,function(n,t,e){return _.isArray(t)&&(t=D(t)),n[e]=t,n},{})}function u(n){n.__events__=O(n.elements,function(n,t,e){return n[e]=s(t),n},{})}function s(n){return O(n,function(n,t,e){return _.isArray(t)&&(n["$"+e]=z(t)),n},{})}function f(n){j(n.actions,"all")||n.actions.unshift("all")}function l(n){return document.querySelectorAll(n)}function h(n){var t=$?$:l;return t(n)}function m(n,t){if(!t)throw new Error("JSkit.Controller.cacheElements: action is undefined");var e=n.__elements__[t];e&&g(e,function(t,e){var r=n["$"+e]=h(t);if(!r.length)throw new Error("JSkit.Controller.cacheElements: "+t+" is not in the DOM")})}function v(n){n.cacheElements=function(t){return m(n,t)}}function p(n,t){g(n.__events__[t],function(e,r){n[r]||m(n,t),d(n,r,e)})}function d(n,t,e){var r=w(E(e),n),i=w($.prototype.on,n[t]);r(i)}function E(n){return n instanceof Function?n:function(t){var e=this;g(n,function(n,r){t(r,e[n])})}}function S(n){n.registerEvents=function(t){return p(n,t)}}function k(n){var t=["registerEvents","registerActions","cacheElements","actionEventName"];g(q(n),function(n){if(j(t,n))throw new Error("JSkit.Controller.create: "+n+" is a restricted keyword")})}var w=_.bind,C=_.bindAll,J=(_.cloneDeep,_.compact),A=_.defaults,g=_.each,y=_.extend,D=_.first,b=_.flatten,j=_.includes,x=(_.isArray,_.isFunction),N=_.isObject,q=_.keys,z=_.last,F=_.map,O=_.reduce,U=_.snakeCase;return{create:function(e){if(e=y({},e),!e.name)throw new Error("JSkit.Controller: name is undefined");k(e);var r=A(e,{actions:[],channel:"controller",controllerEventName:U(e.name),dispatcher:JSkit.Dispatcher.create(),elements:{},eventSeparator:":",namespace:"",initialize:function(){},all:function(){},actionEventName:function(t){return n(this,t)}});return C(r),f(r),t(r),o(r),c(r),u(r),v(r),S(r),r.initialize(),r}}}(),JSkit.Application=function(){function n(n){if(n=n||"",n.match(/_|-|\s/)){var t=e(n.split(/_|-|\s/g),function(n,t){return t>0?n.charAt(0).toUpperCase()+n.slice(1):n.toLowerCase()}).join("");n=t}else n=n.toString();return n.charAt(0).toUpperCase()+n.slice(1)}var t=_.extend,e=_.map;return{create:function(){var e=JSkit.Dispatcher.create();return{Controllers:{},Dispatcher:e,createController:function(r,i){if(i=i||{},!r)throw new Error("Application.createController(name, attrs): name is undefined");i.name=r;var o=n(r)+"Controller",c=this[o]={create:function(n){return n=n||{name:r},JSkit.Controller.create(t({},i,n))}};return this.Controllers[r]=c.create({dispatcher:e}),this.Controllers[r]}}}}}();