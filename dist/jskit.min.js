var JSKit={};JSKit.Dispatcher=function(){function t(){this.__events__={}}return _.assign(t.prototype,{on:function(t,n,e){var i={context:e||null,handler:n},r=this.__events__[t]=this.__events__[t]||[];_.contains(_.pluck(r,"handler"),n)||r.push(i)},off:function(t,n){var e=this.__events__[t];this.__events__[t]=n?_.reject(e,function(t){return t.handler!==n}):[]},trigger:function(t){var n=this.__events__[t]||[],e=_.rest(arguments);_.each(n,function(t){var n=t.handler,i=t.context;n.apply(i,e)})}}),t}(),JSKit.TestDispatcher=function(){function t(t){return t.called=!1,t.callCount=0,t.calls=[],t}function n(t){var n,e;return n=h(t)?t:a(l(t)),e=h(t)?t:a(f(t)),{name:n,method:e}}function e(t){var e=n(t);return h(t)?'"'+t+'"':"{ "+e.name+': "'+e.method+'" }'}function i(){this.listeners=[],this.events={},this.shadowDispatcher=new JSKit.Dispatcher}var r=_.assign,s=(_.clone,_.contains),o=_.each,a=_.first,c=_.functions,h=_.isString,l=_.keys,u=_.map,p=(_.rest,_.toArray),f=_.values;return r(i.prototype,{on:function(n,e,i){s(this.listeners,i)||this.spyOnControllerMethods(i);var r=t(e);this.events[n]=this.events[n]||[],this.events[n].push(r),this.shadowDispatcher.on(n,function(){this.trackSpy(r,arguments)},this)},spyOnControllerMethods:function(n){var i=u(n.actions,function(t){return e(t)}),r=this;o(c(n),function(e){if(!s(i,e)){var o=n[e];n[e]=function(){return r.trackSpy(n[e],arguments),o.apply(n,arguments)},t(n[e])}},this),this.listeners.push(n)},trigger:function(t,n,e){this.shadowDispatcher.trigger(t,n,e)},trackSpy:function(t,n){t.callCount+=1,t.called=!0,t.calls.push({args:p(n)})},hasAction:function(t,i){var r=!1;if(t.actions.forEach(function(t){e(t)===e(i)&&(r=!0)}),!r)return!1;var s=n(i),o=t[s.method],a=t.actionEventName(s.name),c=o.callCount;return t.dispatcher.trigger(a),o.callCount>c},off:function(){}}),i}(),JSKit.Controller=function(){function t(t,n){if(!t)throw new Error(this.className+": dispatcher is undefined");u(this,n,this),this.dispatcher=t,a.apply(this,[this].concat(f(this))),o.call(this),this.actions.unshift("all"),s.call(this),this.initialize()}function n(t){if(t=t||"",t.match(/_|-|\s/)){var n=map(t.split(/_|-|\s/g),function(t,n){return n>0?t.charAt(0).toUpperCase()+t.slice(1):t.toLowerCase()}).join("");t=n}else t=t.toString();return t.charAt(0).toUpperCase()+t.slice(1)}function e(t){return t=t||"",t.replace(/([A-Z])/g," $1").replace(/^\s?/,"").replace(/-|\s/g,"_").toLowerCase()}function i(t){if(!m(this[t.method]))throw new Error(this.className+' action "'+t.name+this.eventSeparator+t.method+'" method is undefined')}function r(t){var n=v(t),e=n?p(g(t)):t,i=n?p(d(t)):t;return{name:i,method:e}}function s(){l(this.actions,function(t){var n=r(t);i.call(this,n),this.dispatcher.on(this.actionEventName(n.name),this[n.method],this)},this)}function o(){this.name=this.name||"Anonymous",h(this,{eventSeparator:":",actions:[],channel:"controller",className:n(this.name)+"Controller",controllerEventName:e(this.name)})}var a=_.bindAll,c=_.compact,h=_.defaults,l=_.each,u=_.assign,p=_.first,f=_.functions,m=_.isFunction,v=_.isObject,d=_.keys,g=(_.uniq,_.values);return u(t.prototype,{initialize:function(){},all:function(){},actionEventName:function(t){return c([this.namespace,this.channel,this.controllerEventName,t]).join(this.eventSeparator)}}),t}(),JSKit.Application=function(){function t(){this.Controllers={},this.Dispatcher=new JSKit.Dispatcher}function n(t){if(t=t||"",t.match(/_|-|\s/)){var n=i(t.split(/_|-|\s/g),function(t,n){return n>0?t.charAt(0).toUpperCase()+t.slice(1):t.toLowerCase()}).join("");t=n}else t=t.toString();return t.charAt(0).toUpperCase()+t.slice(1)}var e=(_.clone,_.assign),i=(_.first,_.map);return t.prototype.createController=function(t,i){function r(){JSKit.Controller.apply(this,arguments)}var s=i.dispatcher||this.Dispatcher;return i.dispatcher&&delete i.dispatcher,t=n(t),e(i,{name:t}),e(r.prototype,JSKit.Controller.prototype,i),this[i.name+"Controller"]=r,this.Controllers[t]=new r(s,i),this.Controllers[t]},t}(),JSKit.createApplication=function(){return new JSKit.Application};