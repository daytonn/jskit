var JSkit=function(){if(!_)throw new Error("JSkit: lodash or underscore is required");if(!$)throw new Error("JSkit: jQuery or equivalent is required");return{createApplication:function(){return JSkit.Application.create()}}}();JSkit.Dispatcher=function(){function n(n,e){return n.__events__[e]=n.__events__[e]||[],n.__events__[e]}function e(n,e){return n=n||null,{context:n,handler:e}}function t(n,e,t){t=t||"push",r(i(n,"handler"),e.handler)||n[t](e)}var r=_.contains,i=_.pluck;return{create:function(){return{__events__:{},on:function(r,i,o){var c=e(o,i),a=n(this,r);t(a,c)},before:function(r,i,o){var c=e(o,i),a=n(this,r);t(a,c,"unshift")},off:function(n,e){var t=this.__events__[n];this.__events__[n]=e?_.reject(t,function(n){return n.handler!==e}):[]},trigger:function(n){var e=this.__events__[n]||[],t=_.rest(arguments);_.each(e,function(n){var e=n.handler,r=n.context;e.apply(r,t)})}}}}}(),JSkit.Controller=function(){function n(n){return n=n||"",n.replace(/([A-Z])/g," $1").replace(/^\s?/,"").replace(/-|\s/g,"_").toLowerCase()}function e(n){m(n.actions,function(e){m(t(e),function(e){i(n,e),n.dispatcher.on(o(n,e.name),n[e.method],n)},n)},n)}function t(n){return S(n)?w(n,r):[r(n,n)]}function r(n,e){return{name:e,method:n}}function i(n,e){if(!C(n[e.method]))throw new Error(n.name+' action "'+e.name+":"+e.method+'" method is undefined')}function o(n,e){return h([n.namespace,n.channel,n.controllerEventName,e]).join(n.eventSeparator)}function c(n,e){l(n.elements,d)[e]&&m(l(n.elements,d)[e],function(e,t){n["$"+t]=$(e)},n)}function a(n,e){l(n.elements,k)[e]&&m(l(n.elements,k)[e],function(e,t){m(e,function(e,r){var i=n[e],o=n["$"+t];o.on(r,i)},n)},n)}function u(n){m(l(n.elements,d),function(e,t){n.dispatcher.before(o(n,t),function(){c(n,t)},n)},n)}function s(n){m(l(n.elements,k),function(e,t){n.dispatcher.on(o(n,t),function(){a(n,t)},n)},n)}function l(n,e){return J(n,function(n,t,r){return n[r]={},m(t,function(t,i){n[r][i]=e(v([t]))}),n},{})}{var f=_.bindAll,h=_.compact,p=_.defaults,m=_.each,d=_.first,v=_.flatten,C=(_.functions,_.isFunction),S=_.isObject,k=(_.keys,_.last),w=_.map,J=(_.pairs,_.reduce);_.uniq,_.values}return{create:function(t){if(t=t||{},!t.name)throw new Error("Controller.create(name): name is undefined");var r=p(t,{actions:[],namespace:"",channel:"controller",controllerEventName:n(t.name),dispatcher:JSkit.Dispatcher.create(),elements:{},eventSeparator:":",all:function(){},initialize:function(){}});return f(r),r.actions.unshift("all"),u(r),s(r),e(r),r.initialize(),r}}}(),JSkit.Application=function(){function n(n){if(n=n||"",n.match(/_|-|\s/)){var e=t(n.split(/_|-|\s/g),function(n,e){return e>0?n.charAt(0).toUpperCase()+n.slice(1):n.toLowerCase()}).join("");n=e}else n=n.toString();return n.charAt(0).toUpperCase()+n.slice(1)}var e=_.extend,t=_.map;return{create:function(){var t=JSkit.Dispatcher.create();return{Controllers:{},Dispatcher:t,createController:function(r,i){if(i=i||{},!r)throw new Error("Application.createController(name, attrs): name is undefined");i.name=r;var o=n(r)+"Controller",c=this[o]={create:function(n){return n=n||{name:r},JSkit.Controller.create(e({},i,n))}};return this.Controllers[r]=c.create({dispatcher:t}),this.Controllers[r]}}}}}();