var JSkit=function(){if(!_)throw new Error("JSkit: lodash or underscore is required");if(!$)throw new Error("JSkit: jQuery or equivalent is required");return{createApplication:function(){return JSkit.Application.create()}}}();JSkit.Dispatcher=function(){function n(n,e){return n.__events__[e]=n.__events__[e]||[],n.__events__[e]}function e(n,e){return n=n||null,{context:n,handler:e}}function t(n,e,t){t=t||"push",r(i(n,"handler"),e.handler)||n[t](e)}var r=_.contains,i=_.pluck,o=_.each;return{create:function(){return{__events__:{},on:function(r,i,o){var c=e(o,i),a=n(this,r);t(a,c)},before:function(r,i,o){var c=e(o,i),a=n(this,r);t(a,c,"unshift")},off:function(n,e){var t=this.__events__[n];e?this.__events__[n]=_.reject(t,function(n){return n.handler!==e}):this.__events__[n]=[]},trigger:function(n){var e=this.__events__[n]||[],t=_.rest(arguments);o(e,function(n){var e=n.handler,r=n.context;e.apply(r,t)})}}}}}(),JSkit.Controller=function(){function n(n,e){return w([n.namespace,n.channel,n.controllerEventName,e]).join(n.eventSeparator)}function e(n){n.__actions__=A(x(n.actions,function(n){return t(n)}))}function t(n){return D(n)?x(n,r):[r(n,n)]}function r(n,e){return{name:e,method:n}}function i(n,e){if(!y(n[e.method]))throw new Error(n.name+' action "'+e.name+":"+e.method+'" method is undefined')}function o(e){S(e.__actions__,function(t){i(e,t),e.dispatcher.on(n(e,t.name),e[t.method],e)})}function c(n){n.__elements__=N(n.elements,function(n,e,t){return n[t]=a(e),n},{})}function a(n){return N(n,function(n,e,t){return _.isArray(e)&&(e=J(e)),n[t]=e,n},{})}function u(n){n.__events__=N(n.elements,function(n,e,t){return n[t]=s(e),n},{})}function s(n){return N(n,function(n,e,t){return _.isArray(e)&&(n["$"+t]=q(e)),n},{})}function l(n){g(n.actions,"all")||n.actions.unshift("all")}function f(n,e){if(!e)throw new Error("JSkit.Controller.cacheElements: action is undefined");var t=n.__elements__[e];t&&S(t,function(e,t){var r=$?$:function(n){return document.querySelectorAll(n)},i=n["$"+t]=r(e);if(!i.length)throw new Error("JSkit.Controller.cacheElements: "+e+" is not in the DOM")})}function h(n){n.cacheElements=function(e){return f(n,e)}}function m(n,e){S(n.__events__[e],function(t,r){n[r]||f(n,e),v(n,r,t)})}function v(n,e,t){S(t,function(t,r){n[e].on(r,n[t])})}function d(n){n.registerEvents=function(e){return m(n,e)}}function p(n){var e=["registerEvents","registerActions","cacheElements","actionEventName"];S(j(n),function(n){if(g(e,n))throw new Error("JSkit.Controller.create: "+n+" is a restricted keyword")})}var k=_.bindAll,w=(_.cloneDeep,_.compact),E=_.defaults,S=_.each,C=_.extend,J=_.first,A=_.flatten,g=_.includes,y=(_.isArray,_.isFunction),D=_.isObject,j=_.keys,q=_.last,x=_.map,N=_.reduce,b=_.snakeCase;return{create:function(t){if(t=C({},t),!t.name)throw new Error("JSkit.Controller: name is undefined");p(t);var r=E(t,{actions:[],channel:"controller",controllerEventName:b(t.name),dispatcher:JSkit.Dispatcher.create(),elements:{},eventSeparator:":",namespace:"",initialize:function(){},all:function(){},actionEventName:function(e){return n(this,e)}});return k(r),l(r),e(r),o(r),c(r),u(r),h(r),d(r),r.initialize(),r}}}(),JSkit.Application=function(){function n(n){if(n=n||"",n.match(/_|-|\s/)){var e=t(n.split(/_|-|\s/g),function(n,e){return e>0?n.charAt(0).toUpperCase()+n.slice(1):n.toLowerCase()}).join("");n=e}else n=n.toString();return n.charAt(0).toUpperCase()+n.slice(1)}var e=_.extend,t=_.map;return{create:function(){var t=JSkit.Dispatcher.create();return{Controllers:{},Dispatcher:t,createController:function(r,i){if(i=i||{},!r)throw new Error("Application.createController(name, attrs): name is undefined");i.name=r;var o=n(r)+"Controller",c=this[o]={create:function(n){return n=n||{name:r},JSkit.Controller.create(e({},i,n))}};return this.Controllers[r]=c.create({dispatcher:t}),this.Controllers[r]}}}}}();