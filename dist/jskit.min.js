var JSkit=function(){if(!_)throw new Error("JSkit: lodash or underscore is required");if(!$)throw new Error("JSkit: jQuery or equivalent is required");return{createApplication:function(){return JSkit.Application.create()}}}();JSkit.Dispatcher=function(){function n(n,e){return n.__events__[e]=n.__events__[e]||[],n.__events__[e]}function e(n,e){return n=n||null,{context:n,handler:e}}function t(n,e,t){t=t||"push",r(i(n,"handler"),e.handler)||n[t](e)}var r=_.contains,i=_.pluck,o=_.each;return{create:function(){return{__events__:{},on:function(r,i,o){var c=e(o,i),a=n(this,r);t(a,c)},before:function(r,i,o){var c=e(o,i),a=n(this,r);t(a,c,"unshift")},off:function(n,e){var t=this.__events__[n];e?this.__events__[n]=_.reject(t,function(n){return n.handler!==e}):this.__events__[n]=[]},trigger:function(n){var e=this.__events__[n]||[],t=_.rest(arguments);o(e,function(n){var e=n.handler,r=n.context;e.apply(r,t)})}}}}}(),JSkit.Controller=function(){function n(n,e,t){return J(D(n,e,t))}function e(n,e){return w([n.namespace,n.channel,n.controllerEventName,e]).join(n.eventSeparator)}function t(e){e.__actions__=n(e.actions,function(n){return r(n)})}function r(n){return y(n)?D(n,i):[i(n,n)]}function i(n,e){return{name:e,method:n}}function o(n,e){if(!g(n[e.method]))throw new Error(n.name+' action "'+e.name+":"+e.method+'" method is undefined')}function c(n){C(n.__actions__,function(t){o(n,t),n.dispatcher.on(e(n,t.name),n[t.method],n)})}function a(n){n.__elements__=q(n.elements,function(n,e,t){return n[t]=u(e),n},{})}function u(n){return q(n,function(n,e,t){return _.isArray(e)&&(e=E(e)),n[t]=e,n},{})}function s(n){n.__events__=q(n.elements,function(n,e,t){return n[t]=l(e),n},{})}function l(n){return q(n,function(n,e,t){return _.isArray(e)&&(n["$"+t]=j(e)),n},{})}function f(n){A(n.actions,"all")||n.actions.unshift("all")}function h(n,e){if(!jQuery)throw new Error("JSkit.Controller.cacheElements: jQuery is required to use element cacheing");if(!e)throw new Error("JSkit.Controller.cacheElements: action is undefined");var t=n.__elements__[e];t&&C(t,function(e,t){var r=n["$"+t]=$(e);if(!r.length)throw new Error("JSkit.Controller.cacheElements: "+e+" is not in the DOM")})}function m(n){n.cacheElements=function(e){return h(n,e)}}function v(n,e){C(n.__events__[e],function(t,r){n[r]||h(n,e),d(n,r,t)})}function d(n,e,t){C(t,function(t,r){n[e].on(r,n[t])})}function p(n){n.registerEvents=function(e){return v(n,e)}}var k=_.bindAll,w=_.compact,S=_.defaults,C=_.each,E=_.first,J=_.flatten,A=_.includes,g=(_.isArray,_.isFunction),y=_.isObject,j=(_.keys,_.last),D=_.map,q=_.reduce,b=_.snakeCase;return{create:function(n){if(n=n||{},!n.name)throw new Error("JSkit.Controller: name is undefined");var r=S(n,{actions:[],channel:"controller",controllerEventName:b(n.name),dispatcher:JSkit.Dispatcher.create(),elements:{},eventSeparator:":",namespace:"",initialize:function(){},all:function(){},actionEventName:function(n){return e(this,n)}});return k(r),f(r),t(r),c(r),a(r),s(r),m(r),p(r),r.initialize(),r}}}(),JSkit.Application=function(){function n(n){if(n=n||"",n.match(/_|-|\s/)){var e=t(n.split(/_|-|\s/g),function(n,e){return e>0?n.charAt(0).toUpperCase()+n.slice(1):n.toLowerCase()}).join("");n=e}else n=n.toString();return n.charAt(0).toUpperCase()+n.slice(1)}var e=_.extend,t=_.map;return{create:function(){var t=JSkit.Dispatcher.create();return{Controllers:{},Dispatcher:t,createController:function(r,i){if(i=i||{},!r)throw new Error("Application.createController(name, attrs): name is undefined");i.name=r;var o=n(r)+"Controller",c=this[o]={create:function(n){return n=n||{name:r},JSkit.Controller.create(e({},i,n))}};return this.Controllers[r]=c.create({dispatcher:t}),this.Controllers[r]}}}}}();