var JSkit=function(){if(!_)throw new Error("JSkit: lodash or underscore is required");if(!$)throw new Error("JSkit: jQuery or equivalent is required");return{createApplication:function(){return JSkit.Application.create()}}}();JSkit.Dispatcher=function(){function n(n,t){return n.__events__[t]=n.__events__[t]||[],n.__events__[t]}function t(n,t){return n=n||null,{context:n,handler:t}}function e(n,t,e){e=e||"push",r(i(n,"handler"),t.handler)||n[e](t)}var r=_.contains,i=_.pluck,o=_.each;return{create:function(){return{__events__:{},on:function(r,i,o){var c=t(o,i),a=n(this,r);e(a,c)},before:function(r,i,o){var c=t(o,i),a=n(this,r);e(a,c,"unshift")},off:function(n,t){var e=this.__events__[n];t?this.__events__[n]=_.reject(e,function(n){return n.handler!==t}):this.__events__[n]=[]},trigger:function(n){var t=this.__events__[n]||[],e=_.rest(arguments);o(t,function(n){var t=n.handler,r=n.context;t.apply(r,e)})}}}}}(),JSkit.Controller=function(){function n(n,t){return S([n.namespace,n.channel,n.controllerEventName,t]).join(n.eventSeparator)}function t(n){n.__actions__=y(N(n.actions,function(n){return e(n)}))}function e(n){return b(n)?N(n,r):[r(n,n)]}function r(n,t){return{name:t,method:n}}function i(n,t){if(!j(n[t.method]))throw new Error(n.name+' action "'+t.name+":"+t.method+'" method is undefined')}function o(t){J(t.__actions__,function(e){i(t,e),t.dispatcher.on(n(t,e.name),t[e.method],t)})}function c(n){n.__elements__=z(n.elements,function(n,t,e){return n[e]=a(t),n},{})}function a(n){return z(n,function(n,t,e){return _.isArray(t)&&(t=g(t)),n[e]=t,n},{})}function u(n){n.__events__=z(n.elements,function(n,t,e){return n[e]=s(t),n},{})}function s(n){return z(n,function(n,t,e){return _.isArray(t)&&(n["$"+e]=x(t)),n},{})}function l(n){D(n.actions,"all")||n.actions.unshift("all")}function f(n,t){if(!t)throw new Error("JSkit.Controller.cacheElements: action is undefined");var e=n.__elements__[t];e&&J(e,function(t,e){var r=$?$:function(n){return document.querySelectorAll(n)},i=n["$"+e]=r(t);if(!i.length)throw new Error("JSkit.Controller.cacheElements: "+t+" is not in the DOM")})}function h(n){n.cacheElements=function(t){return f(n,t)}}function m(n,t){J(n.__events__[t],function(e,r){n[r]||f(n,t),v(n,r,e)})}function v(n,t,e){var r=w(d(e),n),i=w($.prototype.on,n[t]);r(i)}function d(n){return n instanceof Function?n:function(t){var e=this;J(n,function(n,r){t(r,e[n])})}}function p(n){n.registerEvents=function(t){return m(n,t)}}function k(n){var t=["registerEvents","registerActions","cacheElements","actionEventName"];J(q(n),function(n){if(D(t,n))throw new Error("JSkit.Controller.create: "+n+" is a restricted keyword")})}var w=_.bind,E=_.bindAll,S=(_.cloneDeep,_.compact),C=_.defaults,J=_.each,A=_.extend,g=_.first,y=_.flatten,D=_.includes,j=(_.isArray,_.isFunction),b=_.isObject,q=_.keys,x=_.last,N=_.map,z=_.reduce,F=_.snakeCase;return{create:function(e){if(e=A({},e),!e.name)throw new Error("JSkit.Controller: name is undefined");k(e);var r=C(e,{actions:[],channel:"controller",controllerEventName:F(e.name),dispatcher:JSkit.Dispatcher.create(),elements:{},eventSeparator:":",namespace:"",initialize:function(){},all:function(){},actionEventName:function(t){return n(this,t)}});return E(r),l(r),t(r),o(r),c(r),u(r),h(r),p(r),r.initialize(),r}}}(),JSkit.Application=function(){function n(n){if(n=n||"",n.match(/_|-|\s/)){var t=e(n.split(/_|-|\s/g),function(n,t){return t>0?n.charAt(0).toUpperCase()+n.slice(1):n.toLowerCase()}).join("");n=t}else n=n.toString();return n.charAt(0).toUpperCase()+n.slice(1)}var t=_.extend,e=_.map;return{create:function(){var e=JSkit.Dispatcher.create();return{Controllers:{},Dispatcher:e,createController:function(r,i){if(i=i||{},!r)throw new Error("Application.createController(name, attrs): name is undefined");i.name=r;var o=n(r)+"Controller",c=this[o]={create:function(n){return n=n||{name:r},JSkit.Controller.create(t({},i,n))}};return this.Controllers[r]=c.create({dispatcher:e}),this.Controllers[r]}}}}}();